pipeline {

environment {
   existin_repo_name = 'LaunchSatya'

}
    agent any

    stages {
         stage('RepoSync') {
            steps {

             sh "ls -ltr"

                 }
                 }
                  stage('Syncronize SECOND'){
                         steps {
                          withCredentials([usernamePassword(credentialsId: 'KKTBITBUCKET', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) {
                         //sh 'git clone --bare Testing.git source_repository'
                        // dir("source_repository") {
                      // sh  'curl -u "${username}:${password}" https://api.github.com/user/repos -d "{\"name\":\"$existin_repo_name\", \"private\":\"true\" , \"description\":\"Private Repo for ${username} Project - ${existin_repo_name}\" }'
                       sh 'curl -u "${username}:${password}" https://api.github.com/user/repos -d '{\"name\":\"$existin_repo_name\"}'
		       		     //# Remember replace USER with your username and REPO with your repository/application name!
		       		     sh 'git remote add origin git@github.com:kdhulipudi/$existin_repo_name.git'
                 sh 'git push origin master'
                       //  try{
                             //add a remote repository

                             sh 'git remote rm second'
                             sh 'git remote add  second https://$USERNAME:$PASSWORD@github.com/kdhulipudi/LaunchSatya.git'
                            // sh 'git remote set-url  second https://$USERNAME:$PASSWORD@github.com/hdhulipudi/Test.git'
                            // sync back the second repository
                           sh 'git show-ref'
                             sh( 'git push https://$USERNAME:$PASSWORD@github.com/hdhulipudi/Test.git --tags')
                             sh ('git push second  master')

                                  //   }catch(all){
                         //    echo 'aaa'
                         //    }
                             // update the local copy from the first repository
                        //     sh 'git fetch origin --tags'

                             // update the local copy with the second repository
                           //sh 'git fetch second --tags'


                            //sh 'git push second --tags'
                        // }
                         }
                         }
        }
                 }
                 }
